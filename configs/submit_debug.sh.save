#!/bin/bash
#SBATCH --job-name=avatarfp-debug
#SBATCH --partition=RTX3090
#SBATCH --gpus=1
#SBATCH --cpus-per-gpu=6
#SBATCH --mem=32G
#SBATCH --time=01:00:00
#SBATCH --output=slurm-%j.out

# Container Settings
CONTAINER=/netscratch/fschulz/video_deanon_train.sqsh
WORKDIR=$(pwd)
DATADIR=/ds/avatars
SCRATCH=/netscratch/$USER/avatar-fp-debug

mkdir -p $SCRATCH

srun -K \
  --container-image=$CONTAINER \
  --container-workdir=$WORKDIR \
  --container-mounts="$WORKDIR":"$WORKDIR",$DATADIR:$DATADIR:ro,$SCRATCH:$SCRATCH \
  python train.py \
    --data_root $DATADIR \
    --work_dir $SCRATCH \
    --F 31 \
    --batch_identities 2 \
    --clips_per_id 4 \
    --epochs 2 \
    --amp \
    --grad_accum 1
